{
  "Logging": {
    "LogLevel": {
      "Default": "Warning",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.EntityFrameworkCore": "Warning",
      "FakeMicro": "Information",
      "Orleans": "Warning"
    },
    "Console": {
      "FormatterName": "simple",
      "FormatterOptions": {
        "SingleLine": true,
        "IncludeScopes": false,
        "TimestampFormat": "yyyy-MM-dd HH:mm:ss.fff "
      }
    }
  },
  "ConnectionStrings": {
    "Default": "Host=${DB_HOST};Port=${DB_PORT};Database=${DB_NAME};Username=${DB_USERNAME};Password=${DB_PASSWORD};SearchPath=public;Pooling=true;MaxPoolSize=100;Timeout=30;Command Timeout=30;",
    "CAP": "Host=${DB_HOST};Port=${DB_PORT};Database=${CAP_DB_NAME};Username=${DB_USERNAME};Password=${DB_PASSWORD};SearchPath=public;Pooling=true;MaxPoolSize=50;Timeout=30;Command Timeout=30;",
    "Hangfire": "Host=${DB_HOST};Port=${DB_PORT};Database=${HANGFIRE_DB_NAME};Username=${DB_USERNAME};Password=${DB_PASSWORD};SearchPath=public;Pooling=true;MaxPoolSize=50;Timeout=30;Command Timeout=30;",
    "MongoDB": "mongodb://${MONGO_USERNAME}:${MONGO_PASSWORD}@${MONGO_HOST}:${MONGO_PORT}/${MONGO_DB_NAME}?authSource=admin&ssl=true&retryWrites=true&w=majority"
  },
  "MongoDB": {
    "ConnectionString": "mongodb://${MONGO_USERNAME}:${MONGO_PASSWORD}@${MONGO_HOST}:${MONGO_PORT}/${MONGO_DB_NAME}?authSource=admin&ssl=true&retryWrites=true&w=majority",
    "DatabaseName": "${MONGO_DB_NAME}",
    "EnableLogging": false,
    "ConnectionTimeout": 30,
    "MaxConnectionPoolSize": 200,
    "MinConnectionPoolSize": 20,
    "RetryWrites": true,
    "WTimeout": 5000
  },
  "Jwt": {
    "SecretKey": "${JWT_SECRET_KEY}",
    "Issuer": "FakeMicro",
    "Audience": "FakeMicro-Users",
    "ExpireMinutes": 1440,
    "RefreshExpireDays": 7,
    "ClockSkewMinutes": 5,
    "ValidateLifetime": true,
    "ValidateIssuerSigningKey": true
  },
  "RabbitMQ": {
    "HostName": "${RABBITMQ_HOST}",
    "Port": "${RABBITMQ_PORT}",
    "UserName": "${RABBITMQ_USERNAME}",
    "Password": "${RABBITMQ_PASSWORD}",
    "VirtualHost": "${RABBITMQ_VHOST}",
    "RequestedHeartbeat": 60,
    "SocketReadTimeout": 30000,
    "SocketWriteTimeout": 30000,
    "RequestedChannelMax": 1000,
    "PrefetchCount": 100
  },
  "SqlSugar": {
    "DbType": "PostgreSQL",
    "ConnectionString": "Host=${DB_HOST};Port=${DB_PORT};Database=${DB_NAME};Username=${DB_USERNAME};Password=${DB_PASSWORD};SearchPath=public;Pooling=true;MaxPoolSize=100;Timeout=30;Command Timeout=30;",
    "EnableSqlLog": false,
    "SlowQueryThreshold": 1000,
    "EnableAop": false,
    "ConnectionPoolSize": 100,
    "ConnectionTimeout": 30,
    "EnableReadWriteSeparation":"${ENABLE_READ_WRITE_SEPARATION}",
    "SlaveConnectionStrings": [
      "Host=${SLAVE_DB_HOST_1};Port=${DB_PORT};Database=${DB_NAME};Username=${DB_USERNAME};Password=${DB_PASSWORD};SearchPath=public;Pooling=true;MaxPoolSize=100;Timeout=30;Command Timeout=30;",
      "Host=${SLAVE_DB_HOST_2};Port=${DB_PORT};Database=${DB_NAME};Username=${DB_USERNAME};Password=${DB_PASSWORD};SearchPath=public;Pooling=true;MaxPoolSize=100;Timeout=30;Command Timeout=30;"
    ]
  },
  "Database": {
    "Type": "PostgreSQL",
    "Database": "${DB_NAME}",
    "Port": "${ DB_PORT }",
    "Username": "${DB_USERNAME}",
    "Password": "${DB_PASSWORD}",
    "Server": "${DB_HOST}",
    "TrustServerCertificate": true,
    "ConnectionTimeout": 30,
    "IncludeErrorDetail": false
  },
  "CAP": {
    "FailedRetryCount": "5",
    "FailedRetryInterval": "60",
    "SucceedMessageExpiredAfter": "86400",

    "DashboardAllowAnonymous": true,
    "Publisher": {
      "RetryCount": 3,
      "RetryDelay": 1000
    },
    "Subscriber": {
      "RetryCount": 3,
      "RetryDelay": 1000,
      "Parallelism": 5,
      "MaxDegreeOfParallelism": 10
    },
    "Dashboard": {
      "PathMatch": "/cap-dashboard",
      "AllowAnonymous": false
    }
  },
  "FileStorage": {
    "BasePath": "${FILE_STORAGE_PATH}",
    "MaxFileSize": 104857600,
    "AllowedExtensions": [ ".jpg", ".jpeg", ".png", ".pdf", ".doc", ".docx" ],
    "AllowedFileTypes": [ "image/jpeg", "image/png", "application/pdf" ],
    "PreviewBaseUrl": "https://${API_DOMAIN}/api/files/preview",
    "DefaultPreviewExpiryMinutes": 60,
    "EnableCleanup": true,
    "CleanupIntervalHours": 24,
    "RetentionDays": 30
  },
  "RateLimit": {
    "WindowSeconds": 60,
    "MaxRequests": 5000,
    "BurstLimit": 1000,
    "EnableRateLimit": true,
    "StatusCodes": {
      "TooManyRequests": 429
    },
    "ClientIdHeader": "X-Client-Id",
    "ClientWhitelist": []
  },
  "Elasticsearch": {
    "Url": "${ELASTICSEARCH_URL}",
    "IndexFormat": "fakemicro-api-logs-{0:yyyy.MM}",
    "NumberOfShards": 3,
    "NumberOfReplicas": 2,
    "Enable": true,
    "BulkSize": 1000,
    "FlushIntervalSeconds": 10
  },
  "Orleans": {
    "ClusterId": "FakeMicroCluster-Production",
    "ServiceId": "FakeMicroService",
    "SiloPort": 11111,
    "GatewayPort": 30000,
    "UseLocalhostClustering": false,
    "ConnectionString": "${ORLEANS_CONNECTION_STRING}",
    "Client": {
      "ResponseTimeout": "00:00:30",
      "NetworkTimeout": "00:01:00",
      "PingInterval": "00:00:10",
      "MaxRetries": 3,
      "RetryDelay": "00:00:02",
      "MaxMessageSize": 10485760,
      "MessageBatchSize": 100,
      "EnableMessageSerializationDebugViews": false
    },
    "GatewayListProvider": {
      "Type": "StaticGatewayListProvider",
      "Options": {
        "Gateways": []
      }
    }
  },
  "AnomalyDetection": {
    "Enabled": true,
    "FailedAttemptsThreshold": 10,
    "ShortTimeWindowSeconds": 60,
    "LongFailedAttemptsThreshold": 50,
    "LongTimeWindowMinutes": 60,
    "BlockDurationMinutes": 30,
    "MaxRequestsPerMinute": 100,
    "BlockSuspiciousIps": true,
    "LogAnomalies": true,
    "ExcludedPaths": [
      "/health",
      "/metrics",
      "/swagger"
    ]
  },
  "ApiSecurity": {
    "EnableApiKeyAuth": true,
    "ApiKeyHeaderName": "X-API-Key",
    "EnableRequestSigning": true,
    "SignatureHeaderName": "X-Signature",
    "TimestampHeaderName": "X-Timestamp",
    "AllowedTimestampDriftSeconds": 300,
    "ApiKeyLength": 40,
    "KeyPrefixLength": 8
  },
  "Swagger": {
    "Enabled": true,
    "RequireAuth": true,
    "Username": "${SWAGGER_USERNAME}",
    "Password": "${SWAGGER_PASSWORD}",
    "Title": "FakeMicro API",
    "Version": "v1"
  },
  "Cors": {
    "AllowOrigins": [
      "https://${WEB_DOMAIN}",
      "https://${APP_DOMAIN}"
    ],
    "AllowMethods": [
      "GET",
      "POST",
      "PUT",
      "DELETE",
      "PATCH",
      "OPTIONS"
    ],
    "AllowHeaders": [
      "Authorization",
      "Content-Type",
      "X-Requested-With"
    ],
    "AllowCredentials": true,
    "MaxAge": 3600
  },
  "Kestrel": {
    "Endpoints": {
      "Https": {
        "Url": "https://0.0.0.0:5001",
        "Certificate": {
          "Path":"",//     "${SSL_CERT_PATH}",
          "Password":"" //"${SSL_CERT_PASSWORD}"
        }
      }
    },
    "Limits": {
      "MaxConcurrentConnections": 10000,
      "MaxConcurrentUpgradedConnections": 1000,
      "MaxRequestBodySize": 52428800,
      "MinRequestBodyDataRate": {
        "BytesPerSecond": 4096
      },
      "MinResponseDataRate": {
        "BytesPerSecond": 4096
      },
      "RequestHeadersTimeout": "00:00:30",
      "KeepAliveTimeout": "00:02:00",
      "MaxRequestBufferSize": 1048576
    },
    "ResponseHeaders": {
      "Server": "Kestrel"
    },
    "AddServerHeader": false,
    "DisableStringReuse": false
  },
  "Http": {
    "Timeout": 30,
    "MaxConnectionsPerServer": 100,
    "PooledConnectionLifetime": "00:05:00",
    "PooledConnectionIdleTimeout": "00:02:00",
    "MaxResponseDrainSize": 1048576
  },
  "AllowedHosts": "${API_DOMAIN}"
}